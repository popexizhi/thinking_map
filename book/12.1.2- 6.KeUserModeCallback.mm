<map version="0.9.0">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node CREATED="1563157006117" ID="ID_708272455" MODIFIED="1563157028798" TEXT="12.1.2- 6.KeUserModeCallback">
<node CREATED="1563157029922" ID="ID_126412639" MODIFIED="1563157066301" POSITION="right" TEXT="&#x56de;&#x8c03;user32.dll!_clentLoadLibrary &#x52a0;&#x8f7d;dll"/>
<node CREATED="1563157066866" ID="ID_922309225" MODIFIED="1563157092446" POSITION="right" TEXT="&#x56de;&#x8c03;ShellCode"/>
<node CREATED="1565748065238" ID="ID_532006618" MODIFIED="1565748348443" POSITION="right">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      [next] 14/8/2019
    </p>
    <p>
      P478 - 12)
    </p>
    <p>
      pNewInfo-&gt;lpDLLPath.Buffer = (PWSTR)sizeof(USERHOOK_NEW);
    </p>
    <p>
      
    </p>
  </body>
</html>
</richcontent>
</node>
<node CREATED="1563157101793" ID="ID_1479334915" MODIFIED="1563157104094" POSITION="left" TEXT="other">
<node CREATED="1563157109170" ID="ID_443206610" MODIFIED="1563157159295" TEXT="[try] easySYS 0.3.0 &#x5bf9;project &#x7684;&#x4f7f;&#x7528;&#x548c;&#x63a7;&#x5236;"/>
<node CREATED="1563157749009" ID="ID_1715778513" MODIFIED="1563157755790" TEXT="[list]">
<node CREATED="1563157756674" FOLDED="true" ID="ID_57034320" MODIFIED="1565749921827" TEXT="win32k.sys">
<icon BUILTIN="button_ok"/>
<node CREATED="1563157765249" ID="ID_515374310" MODIFIED="1563157766045" TEXT="https://blog.csdn.net/cqyczj/article/details/27796451"/>
<node CREATED="1563762467323" ID="ID_666816711" MODIFIED="1563762473032" TEXT="&#x68c0;&#x7d22;">
<node CREATED="1563762477369" ID="ID_1440681379" MODIFIED="1563762482151" TEXT="&#x5b50;&#x7cfb;&#x7edf;">
<node CREATED="1563762483066" ID="ID_1052144384" MODIFIED="1563762488134" TEXT="win32">
<node CREATED="1563762499449" ID="ID_1963053586" MODIFIED="1563762504246" TEXT="user&#x5c42;">
<node CREATED="1563762510970" ID="ID_50762413" MODIFIED="1563762516230" TEXT="csrss.exe">
<node CREATED="1563762525034" ID="ID_299889783" MODIFIED="1563762530534" TEXT="&#x63a7;&#x5236;&#x7a97;&#x53e3;"/>
<node CREATED="1563762530793" ID="ID_1709203246" MODIFIED="1563762549751" TEXT="&#x521b;&#x5efa;/&#x5220;&#x9664;&#xff0c;&#x8fdb;&#x7a0b;&#xff0c;&#x7ebf;&#x7a0b;"/>
</node>
<node CREATED="1563762518314" ID="ID_757651537" MODIFIED="1563762520007" TEXT="dll"/>
</node>
<node CREATED="1563762504490" ID="ID_200289694" MODIFIED="1563762507687" TEXT="&#x5185;&#x6838;&#x5c42;">
<node CREATED="1563762560297" ID="ID_1709889256" MODIFIED="1563762567782" TEXT="win32k.sys"/>
</node>
</node>
<node CREATED="1563762488777" ID="ID_161487499" MODIFIED="1563762493654" TEXT="POSIX"/>
<node CREATED="1563762493945" ID="ID_1869645726" MODIFIED="1563762497558" TEXT="OS/2"/>
</node>
</node>
</node>
<node CREATED="1563243591159" ID="ID_602874558" MODIFIED="1564366698952" TEXT="KeUserModeCallback">
<icon BUILTIN="button_ok"/>
<node CREATED="1563243787907" ID="ID_262220504" MODIFIED="1563243789008" TEXT="https://blog.csdn.net/whatday/article/details/11267699"/>
<node CREATED="1563416564514" ID="ID_176684033" MODIFIED="1563416653039" TEXT="[popexizhi: &#x8fd9;&#x7bc7;&#x4e2d;&#x6709;&#x8be6;&#x7ec6;&#x7684;&#x4f7f;&#x7528;KeUserModeCallback&#x7684;eg&#xff0c;&#x53ef;&#x4ee5;&#x53c2;&#x8003;user32.dll!_clentLoadLibrary&#x7684;&#x5206;&#x6790;&#x4f7f;&#x7528;]"/>
</node>
<node CREATED="1564020820907" FOLDED="true" ID="ID_1312577655" MODIFIED="1564712094393" TEXT="user32.dll">
<icon BUILTIN="button_ok"/>
<node CREATED="1564020828667" ID="ID_213308087" MODIFIED="1564020835159" TEXT="GDI32.dll">
<node CREATED="1564020872809" ID="ID_265509436" MODIFIED="1564020888054" TEXT="&#x5305;&#x542b;&#x7684;&#x51fd;&#x6570;&#x7528;&#x6765;&#x7ed8;&#x5236;&#x56fe;&#x50cf;&#x548c;&#x663e;&#x793a;&#x6587;&#x5b57;"/>
</node>
<node CREATED="1564020835658" ID="ID_1368551650" MODIFIED="1564020841287" TEXT="user32.dll">
<node CREATED="1564021557002" ID="ID_245024936" MODIFIED="1564021557879" TEXT="User32.dll&#x63d0;&#x4f9b;&#x521b;&#x5efa;&#x548c;&#x7ba1;&#x7406;Windows&#x56fe;&#x5f62;&#x754c;&#x9762;&#x7684;&#x529f;&#x80fd;&#xff0c;&#x4f8b;&#x5982;&#x684c;&#x9762;&#x3001;&#x89c6;&#x7a97;&#x548c;&#x529f;&#x80fd;&#x8868;&#x3002;&#x91cc;&#x9762;&#x7684;&#x51fd;&#x6570;&#x53ef;&#x4ee5;&#x8ba9;&#x5e94;&#x7528;&#x7a0b;&#x5e8f;&#x521b;&#x5efa;&#x53ca;&#x7ba1;&#x7406;&#x89c6;&#x7a97;&#x3001;&#x63a5;&#x6536;Windows&#x6d88;&#x606f;&#xff08;&#x8bf8;&#x5982;&#x7528;&#x6237;&#x7684;&#x8f93;&#x5165;&#x6216;&#x7cfb;&#x7edf;&#x7684;&#x901a;&#x77e5;&#xff09;&#x3001;&#x5728;&#x89c6;&#x7a97;&#x4e2d;&#x663e;&#x793a;&#x6587;&#x5b57;&#xff0c;&#x53ca;&#x663e;&#x793a;&#x4e00;&#x4e2a;&#x6d88;&#x606f;&#x89c6;&#x7a97;&#x3002;  &#x8fd9;&#x4e2a;&#x5e93;&#x91cc;&#x9762;&#x5927;&#x90e8;&#x5206;&#x51fd;&#x6570;&#x4e5f;&#x9700;&#x8981;&#x501a;&#x9760;Gdi32.dll&#x63d0;&#x4f9b;&#x7684;&#x7ed8;&#x56fe;&#x529f;&#x80fd;&#xff0c;&#x6765;&#x5bf9;&#x7528;&#x6237;&#x754c;&#x9762;&#x8fdb;&#x884c;&#x6e32;&#x67d3;&#x3002;&#x6709;&#x4e9b;&#x7a0b;&#x5e8f;&#x8fd8;&#x4f1a;&#x76f4;&#x63a5;&#x4f7f;&#x7528;GDI&#x51fd;&#x6570;&#xff0c;&#x6765;&#x5bf9;&#x5148;&#x524d;&#x7531;User32.dll&#x6240;&#x521b;&#x5efa;&#x7684;&#x89c6;&#x7a97;&#x8fdb;&#x884c;&#x5e95;&#x5c42;&#x7ed8;&#x56fe;&#x3002;"/>
</node>
<node CREATED="1564020841658" ID="ID_296925946" MODIFIED="1564020847463" TEXT="kernel32.dll">
<node CREATED="1564021442730" ID="ID_702892706" MODIFIED="1564021443399" TEXT="kernel32.dll&#x662f;Windows 9x/Me&#x4e2d;&#x975e;&#x5e38;&#x91cd;&#x8981;&#x7684;32&#x4f4d;&#x52a8;&#x6001;&#x94fe;&#x63a5;&#x5e93;&#x6587;&#x4ef6;&#xff0c;&#x5c5e;&#x4e8e;&#x5185;&#x6838;&#x7ea7;&#x6587;&#x4ef6;&#x3002;&#x5b83;&#x63a7;&#x5236;&#x7740;&#x7cfb;&#x7edf;&#x7684;&#x5185;&#x5b58;&#x7ba1;&#x7406;&#x3001;&#x6570;&#x636e;&#x7684;&#x8f93;&#x5165;&#x8f93;&#x51fa;&#x64cd;&#x4f5c;&#x548c;&#x4e2d;&#x65ad;&#x5904;&#x7406;&#xff0c;&#x5f53;Windows&#x542f;&#x52a8;&#x65f6;&#xff0c;kernel32.dll&#x5c31;&#x9a7b;&#x7559;&#x5728;&#x5185;&#x5b58;&#x4e2d;&#x7279;&#x5b9a;&#x7684;&#x5199;&#x4fdd;&#x62a4;&#x533a;&#x57df;&#xff0c;&#x4f7f;&#x522b;&#x7684;&#x7a0b;&#x5e8f;&#x65e0;&#x6cd5;&#x5360;&#x7528;&#x8fd9;&#x4e2a;&#x5185;&#x5b58;&#x533a;&#x57df;&#x3002;"/>
</node>
</node>
<node CREATED="1550629989841" FOLDED="true" ID="ID_559180774" MODIFIED="1564712096481" TEXT="NTSTATUS">
<icon BUILTIN="button_ok"/>
<icon BUILTIN="full-2"/>
<node CREATED="1550629999088" ID="ID_51077595" MODIFIED="1550630008470" TEXT="https://baike.baidu.com/item/NTSTATUS"/>
<node CREATED="1550714592338" ID="ID_761370124" MODIFIED="1550714610464">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      NTSTATUS&#160;&#26159;&#34987;&#23450;&#20041;&#20026;32&#20301;&#30340;&#26080;&#31526;&#21495;&#38271;&#25972;&#22411;&#12290;&#22312;&#39537;&#21160;&#31243;&#24207;&#24320;&#21457;&#20013;&#65292;&#20154;&#20204;&#20064;&#24815;&#29992;&#160;NTSTATUS&#160;&#36820;&#22238;&#29366;&#24577;&#12290;&#20854;&#20013;0~0X7FFFFFFF&#65292;&#34987;&#35748;&#20026;&#26159;&#27491;&#30830;&#30340;&#29366;&#24577;&#65292;&#32780;0X80000000~0XFFFFFFFF&#34987;&#35748;&#20026;&#26159;&#38169;&#35823;&#30340;&#29366;&#24577;&#12290;
    </p>
    <p>
      &#26377;&#19968;&#20010;&#38750;&#24120;&#26377;&#29992;&#30340;&#23439;-----NT_SUCCESS&#65292;&#29992;&#26469;&#26816;&#27979;&#29366;&#24577;&#26159;&#21542;&#27491;&#30830;&#12290;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1564712099359" FOLDED="true" ID="ID_802950340" MODIFIED="1565749916483" TEXT="RtlInitUnicodeString">
<icon BUILTIN="button_ok"/>
<node CREATED="1564712387950" ID="ID_824879676" MODIFIED="1564712398251">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      For more information, see the WdmlibRtlInitUnicodeStringEx function.
    </p>
    <p>
      <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/wdm/nf-wdm-rtlinitunicodestring">https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/wdm/nf-wdm-rtlinitunicodestring</a>
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1564712493166" ID="ID_789171723" MODIFIED="1564971956465">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      The routine copies the SourceString pointer value to the Buffer member of the UNICODE_STRING structure pointed to by DestinationString. The Length member of this structure is set to the length, in bytes, of the source string, excluding the terminating null. The MaximumLength member of the structure is set to the length, in bytes, of the source string, including the terminating null. If SourceString is NULL, Length and MaximumLength are both set to zero.
    </p>
    <p>
      
    </p>
    <p>
      WdmlibRtlInitUnicodeStringEx does not alter the source string pointed to by SourceString.
    </p>
    <p>
      [popexizhi: &#21021;&#22987;&#21270;UnicodeString&#20351;&#29992;&#30340;]
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1564971957820" FOLDED="true" ID="ID_1063500740" MODIFIED="1565749915628" TEXT="ALIGH_UP &#x4e0e; &#x53c2;&#x6570; ULONG_PTR ">
<icon BUILTIN="button_ok"/>
<node CREATED="1564972242972" ID="ID_1508213904" MODIFIED="1565057825604" TEXT="https://www.boost.org/doc/libs/1_68_0/boost/align/align_up.hpp [&#x5185;&#x5b58;&#x8865;&#x9f50;]"/>
<node CREATED="1564972261677" ID="ID_547343215" MODIFIED="1565057954404">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      http://www.myexception.cn/cpp/1476166.html
    </p>
    <p>
      ULONG_PTR
    </p>
    <p>
      ------&#35299;&#20915;&#26041;&#26696;--------------------
    </p>
    <p>
      &#26080;&#31526;&#21495;&#65288;u&#65289; &#38271;&#25972;&#22411;&#65288;long&#65289; &#25351;&#38024;&#65288;ptr&#65289;
    </p>
    <p>
      ------&#35299;&#20915;&#26041;&#26696;--------------------
    </p>
    <p>
      &#24341;&#29992;:
    </p>
    <p>
      1. ULONG_PTR &#21482;&#26159;&#19987;&#38376;&#29992;&#20110;&#20869;&#26680;&#31243;&#24207; (Kernel &#25110; Device Driver) &#20351;&#29992;&#30340;&#25968;&#25454;&#31867;&#22411;&#65292;
    </p>
    <p>
      &#160;&#160;&#160;&#24403;&#20316;&#25351;&#38024;&#26102;&#23427;&#24212;&#24403;&#25351;&#21521;&#31995;&#32479;&#20869;&#26680;&#22320;&#22336;&#31354;&#38388; (&#22240;&#27492;&#26368;&#39640;&#20301;&#20026; 1)&#65292;&#21478;&#22806;&#23427;&#36824;&#21487;&#24403;&#20316;&#20559;&#31227;&#37327;&#12290;
    </p>
    <p>
      2.
    </p>
    <p>
      &#23450;&#20041;&#65306;
    </p>
    <p>
      ULONG_PTR
    </p>
    <p>
      
    </p>
    <p>
      Unsigned LONG_PTR.
    </p>
    <p>
      This type is declared in Basetsd.h as follows:
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1565058253878" FOLDED="true" ID="ID_1456443770" MODIFIED="1565749914147" TEXT="FIELD_OFFSET">
<icon BUILTIN="button_ok"/>
<node CREATED="1565058645751" ID="ID_167694068" MODIFIED="1565058775059">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://docs.microsoft.com/en-us/windows/win32/api/ntdef/nf-ntdef-field_offset
    </p>
    <p>
      The&#160;FIELD_OFFSET&#160;macro returns the byte offset of a named field in a known structure type.
    </p>
    <p>
      &#24403;&#21069;&#20351;&#29992;&#20301;&#32622;&#26159;&#22312;
    </p>
    <p>
      pNewInfo-&gt;offCbkPtrs = FIELD_OFFSET(USERHOOK_NEW,offCbk);
    </p>
    <p>
      &#22312;pNewInfo-&gt;offCbkPtrs &#20013;&#23384;&#25918; USERHOOK_NEW&#32467;&#26500;&#20013;&#30340; offCbk&#20559;&#31227;&#30340;&#22320;&#22336;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1565143824791" FOLDED="true" ID="ID_332508417" MODIFIED="1565749918186" TEXT="wcscpy">
<icon BUILTIN="button_ok"/>
<node CREATED="1565143827736" ID="ID_1692336221" MODIFIED="1565143947039">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://zh.cppreference.com/w/cpp/string/wide/wcscpy
    </p>
    <p>
      &#23450;&#20041;&#20110;&#22836;&#25991;&#20214; &lt;cwchar&gt;
    </p>
    <p>
      wchar_t *wcscpy( wchar_t *dest, const wchar_t *src );
    </p>
    <p>
      &#22797;&#21046; src &#25152;&#25351;&#21521;&#30340;&#23485;&#23383;&#31526;&#20018;&#65288;&#21253;&#21547;&#31354;&#32456;&#27490;&#23485;&#23383;&#31526;&#65289;&#21040; dest &#25152;&#25351;&#21521;&#30340;&#23485;&#23383;&#31526;&#25968;&#32452;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#33509;&#23383;&#31526;&#20018;&#37325;&#21472;&#65292;&#21017;&#34892;&#20026;&#26410;&#23450;&#20041;&#12290;
    </p>
    <p>
      
    </p>
    <p>
      &#21442;&#25968;
    </p>
    <p>
      dest - &#25351;&#21521;&#22797;&#21046;&#26469;&#28304;&#30340;&#23485;&#23383;&#31526;&#25968;&#32452;&#30340;&#25351;&#38024;
    </p>
    <p>
      src - &#25351;&#21521;&#22797;&#21046;&#26469;&#28304;&#30340;&#31354;&#32456;&#27490;&#23485;&#23383;&#31526;&#20018;&#30340;&#25351;&#38024;
    </p>
    <p>
      
    </p>
    <p>
      &#35299;&#37322;:
    </p>
    <p>
      wcscpy((WCHAR*)((BYTE*)pOldInfo + sizeof(USERHOOK_OLD)),wDllPathToInject);
    </p>
    <p>
      &#23558;wDllPathToinject&#25335;&#36125;&#21040;pOldInfo&#32467;&#26500;&#21518;&#38754;
    </p>
  </body>
</html></richcontent>
</node>
</node>
<node CREATED="1565144603624" ID="ID_1644369716" MODIFIED="1565144884271" TEXT="UNICODE_STRING">
<node CREATED="1565144890744" FOLDED="true" ID="ID_320349370" MODIFIED="1565748059322" TEXT="&#x6e90;&#x7801;&#x5206;&#x6790;">
<node CREATED="1565144669559" ID="ID_1601182216" MODIFIED="1565576816390">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      [&#28304;&#30721;]
    </p>
    <p>
      pNewInfo-&gt;lpDLLPath.Length = usDllPath.Length;
    </p>
    <p>
      pNewInfo-&gt;lpDLLPath.MaximumLength = usDllPath.MaximumLength;
    </p>
    <p>
      pNewInfo-&gt;lpDLLPath.Buffer = (PWSTR)sizeof(USERHOOK_NEW);
    </p>
    <p>
      
    </p>
    <p>
      &#36825;&#37324;&#30340;
    </p>
    <p>
      lpDLLPath&#23450;&#20041;&#20026;
    </p>
    <p>
      
    </p>
    <p>
      typedef struct _USERHOOK_NEW
    </p>
    <p>
      {
    </p>
    <p>
      ...
    </p>
    <p>
      /*off=0x18_28*/UNICODE_STRING lpDLLPath; //Dll&#36335;&#24452;,Buffer&#21487;&#33021;&#38656;&#35201;&#20462;&#27491;
    </p>
    <p>
      ...
    </p>
    <p>
      } USERHOOK_NEW;
    </p>
    <p>
      &#36825;&#37324;&#26159;&#65311;&#20160;&#20040;&#26041;&#24335;&#21021;&#22987;&#21270;&#65311;
    </p>
    <p>
      [popexizhi]
    </p>
    <p>
      &#36825;&#37324;Unicode_string&#30340;&#23450;&#20041;&#20013; Length&#21644;MaximumLength&#21487;&#20197;&#35299;&#37322;
    </p>
    <p>
      &#20294;&#26159;Buffer &#30340;&#22788;&#29702;(PWSTR)sizeof(USERHOOK_NEW); &#19981;&#26126;&#30333;
    </p>
    <p>
      
    </p>
    <p>
      &#19979;&#25991;&#20013;&#32473;&#30340;&#19977;&#20010;&#20363;&#23376;:
    </p>
  </body>
</html></richcontent>
<node CREATED="1565576825955" ID="ID_431349136" MODIFIED="1565576887319">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      list:
    </p>
    <p>
      1.&#19977;&#20010;&#20363;&#23376;&#30340;&#20013;&#38382;&#39064;&#20998;&#21035;go
    </p>
    <p>
      2.&#22914;&#20309;&#21306;&#20998;&#22534;&#19978;&#21644;&#26632;&#19978;&#30340;&#21021;&#22987;&#21270;
    </p>
    <p>
      3.&#24403;&#21069;&#26041;&#24335;&#26159;&#20160;&#20040;&#26041;&#24335;&#30340;&#21021;&#22987;&#21270;&#65292;&#36825;&#37324;&#30340;buffer&#25351;&#21521;&#24456;&#22855;&#24618;&#21834;&#65311;
    </p>
  </body>
</html></richcontent>
<node CREATED="1565576897139" ID="ID_319579357" MODIFIED="1565576901552" TEXT="1.&#x4e09;&#x4e2a;&#x4f8b;&#x5b50;">
<node CREATED="1565576817748" ID="ID_1359090803" MODIFIED="1565665358289">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#21021;&#22987;&#21270;UNICODE_STRING&#30340;&#19977;&#31181;&#26041;&#24335;
    </p>
    <p>
      &#23383;&#31526;&#20018;&#24120;&#37327;
    </p>
    <p>
      UNICODE_STRING uStrTest1 = {0};
    </p>
    <p>
      WCHAR *szHello = L&quot;Hello world&quot;;
    </p>
    <p>
      uStrTest1.Length = wcslen(szHello) * sizeof(WCHAR);
    </p>
    <p>
      uStrTest1.MaximumLength = (wcslen(szHello) + 1) * sizeof(WCHAR);
    </p>
    <p>
      RtlInitUnicodeString(&amp;uStrTest1,szHello);
    </p>
    <p>
      // &#31561;&#20215;&#20110; char *str = &quot;hello world&quot;;
    </p>
    <p>
      // uStrTest1.Buffer&#25351;&#21521;&#30340;&#22320;&#22336;&#26159;&#38745;&#24577;&#24120;&#37327;&#21306;,&#25152;&#20197;&#23545;&#30528;uStrTest1&#36827;&#34892;&#20462;&#25913;&#25805;&#20316;&#24517;&#38169;
    </p>
    <p>
      [next: RtlInitUnicodeString https://blog.csdn.net/zfs2008zfs/article/details/51126906 ]
    </p>
    <p>
      [next]
    </p>
    <p>
      try: &#27492;&#20301;&#32622;&#30340;Buffer&#30340;&#36171;&#20540;&#26041;&#24335;&#65292;&#24212;&#35813;&#21487;&#20197;&#20351;&#29992;&#65292;&#35797;&#35797;&#65292;&#20063;&#35768;
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1565661737450" ID="ID_501285459" MODIFIED="1565661745965">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22312;&#26632;&#19978;&#20026;Buffer&#21021;&#22987;&#21270;
    </p>
    <p>
      UNICODE_STRING uStrTest2 = {0};
    </p>
    <p>
      WCHAR szHello2[512] = L&quot;Hello world&quot;;
    </p>
    <p>
      uStrTest2.Buffer = szHello2;
    </p>
    <p>
      uStrTest2.Length = wcslen(L&quot;Hello world&quot;) * sizeof(WCHAR);
    </p>
    <p>
      uStrTest2.MaximumLength = sizeof(szHello2);
    </p>
  </body>
</html></richcontent>
</node>
<node CREATED="1565661745968" ID="ID_1618132531" MODIFIED="1565661745973">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      &#22312;&#22534;&#19978;&#20026;Buffer&#21021;&#22987;&#21270;
    </p>
    <p>
      UNICODE_STRING uStrTest3 = {0};
    </p>
    <p>
      ULONG ulLength = (wcslen(L&quot;Hello world&quot;) * sizeof(WCHAR));
    </p>
    <p>
      // &#20026;Buffer&#22312;&#22534;&#19978;&#20998;&#37197;&#19968;&#22359;&#20869;&#23384;
    </p>
    <p>
      // MAX_PATH : &#20195;&#34920;Windows&#31995;&#32479;&#20013;&#25991;&#20214;&#36335;&#24452;&#30340;&#26368;&#22823;&#38271;&#24230;.&#20540;&#26159;260
    </p>
    <p>
      uStrTest3.Buffer = ExAllocatePoolWithTag(PagedPool,MAX_PATH * sizeof(WCHAR),'POCU');
    </p>
    <p>
      // &#21028;&#26029;&#20869;&#23384;&#26159;&#21542;&#20998;&#37197;&#25104;&#21151;
    </p>
    <p>
      if (uStrTest3.Buffer == NULL)
    </p>
    <p>
      {
    </p>
    <p>
      &#160;&#160;&#160;&#160;return;
    </p>
    <p>
      }
    </p>
    <p>
      // &#20026;&#20998;&#37197;&#21040;&#30340;&#20869;&#23384;&#21021;&#22987;&#21270;
    </p>
    <p>
      RtlZeroMemory(uStrTest3.Buffer,MAX_PATH * sizeof(WCHAR));
    </p>
    <p>
      memcpy(uStrTest3.Buffer,L&quot;Hello world&quot;,ulLength);
    </p>
    <p>
      uStrTest3.Length = ulLength;
    </p>
    <p>
      uStrTest3.MaximumLength = MAX_PATH * sizeof(WCHAR);
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
<node CREATED="1565144904150" FOLDED="true" ID="ID_165108029" MODIFIED="1565748060241" TEXT="&#x89e3;&#x91ca;">
<node CREATED="1565144907446" ID="ID_1496401263" MODIFIED="1565231286762">
<richcontent TYPE="NODE"><html>
  <head>
    
  </head>
  <body>
    <p>
      https://www.jianshu.com/p/1c463ff9d554
    </p>
    <p>
      1.&#20869;&#26680;&#30340;Unicode&#32534;&#30721; &#20351;&#29992;
    </p>
    <p>
      unicode_string
    </p>
    <p>
      2.&#32467;&#26500;&#23450;&#20041;
    </p>
    <p>
      UNICODE_STRING &#23450;&#20041;(definition) :
    </p>
    <p>
      &#160;&#160;&#160;&#160;typedef struct _UNICODE_STRING{
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USHORT LENGTH;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// &#23383;&#33410;&#25968;,&#19981;&#26159;&#23383;&#31526;&#25968;,&#26377;&#25928;&#25968;&#25454;&#30340;&#23383;&#33410;&#25968;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;USHORT MaximumLength;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// &#23383;&#33410;&#25968;,&#21578;&#35785;&#31995;&#32479;&#20989;&#25968;&#26368;&#22810;&#26377;&#22810;&#23569;&#20869;&#23384;&#21487;&#29992;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// &#26368;&#22823;&#21487;&#34920;&#31034;32767&#20010;&#23383;&#31526;
    </p>
    <p>
      &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PWSTR Buffer;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;// &#25351;&#38024;, &#38750;&#38646;&#32467;&#23614;,&#20013;&#38388;&#20063;&#21487;&#33021;&#21547;&#26377;&#38646;
    </p>
    <p>
      &#160;&#160;&#160;&#160;}UNICODE_STRING,*PUNICODE_STRING;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;// &#22240;&#20026;Buffer&#19981;&#26159;&#20197;&#38646;&#32467;&#23614;,&#25152;&#20197;&#29992;wcscpt / wcscmp&#31561;&#25805;&#20316;&#23383;&#31526;&#20018;
    </p>
    <p>
      &#160;&#160;&#160;&#160;// &#30340;&#22788;&#29702;Buffer&#20013;&#30340;&#20540;&#26159;&#19981;&#21487;&#38752;&#30340;,&#22240;&#20026;&#36825;&#20123;&#20989;&#25968;&#26159;&#20197;&#23383;&#31526;&#20018;&#26411;&#23614;&#23383;&#160;&#160;&#160;
    </p>
    <p>
      &#160;&#160;&#160;&#160;// &#31526;'\0'&#20026;&#32467;&#23614;&#26469;&#22788;&#29702;&#23383;&#31526;&#20018;&#30340;.**
    </p>
    <p>
      
    </p>
    <p>
      3.&#21021;&#22987;&#21270;&#26041;&#24335;&#65288;&#23383;&#31526;&#20018;/&#22312;&#26632;&#19978;&#20026;bufffer&#21021;&#22987;&#21270;/&#22312;&#22534;&#19978;&#20026;Buffer&#21021;&#22987;&#21270;&#65289;
    </p>
  </body>
</html></richcontent>
</node>
</node>
</node>
</node>
</node>
</node>
</map>
